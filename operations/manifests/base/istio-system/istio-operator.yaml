---
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
metadata:
  name: istio-profile
spec:
  profile: default
  hub: "docker.io/istio"
  tag: "1.12.1"
  values:
    telemetry:
      v2:
        prometheus:
          configOverride:
            inboundSidecar:
              disable_host_header_fallback: true
            outboundSidecar:
              disable_host_header_fallback: true
            gateway:
              disable_host_header_fallback: true
  meshConfig:
    accessLogFile: /dev/stdout
    accessLogEncoding: JSON
    enableTracing: false
    defaultConfig:
      # Avoid some pods failing on startup for not having network connectivity
      holdApplicationUntilProxyStarts: true
      tracing:
        sampling: 10.0
        zipkin:
          address: tempo-tempo-distributed-distributor.monitoring.svc.cluster.local:9411
  components:
    pilot:
      enabled: true
    cni:
      enabled: false
    ingressGateways:
    # IngressGateways are patched in trough terraform
    egressGateways:
    - name: istio-egressgateway
      enabled: false

